------------------------------------------------------------------------------+
-- PulseOx.aadl - AADL model of a compositional medical device 
--   product, for use in KSU's Medical Device Component Framework (MDCF).
--
-- Generated by the MDCF DML-to-AADL Translator.
--            Kansas State University
------------------------------------------------------------------------------+
package PulseOx
public
  with Base_Types, ICE_Types, MDCF_Types;
  with MDCF_Data_Props, MDCF_Comm_Props;


------------------------------------------------------------------------------+
-- Pulseox virtual medical device (VMD)
------------------------------------------------------------------------------+
system PulseoxDevice
features
  -- Device port groupings
  status: feature group PulseoxStatus;
      
  -- Channel port groupings
  spo2_metrics: feature group PulseoxSpo2Metrics;      
  spo2_settings: feature group PulseoxSpo2Settings;      
  pulserate_metrics: feature group PulseoxPulserateMetrics;      
  pulserate_statuses: feature group PulseoxPulserateStatuses;      
end PulseoxDevice;

system implementation PulseoxDevice.impl
subcomponents
  spo2: system PulseoxSpo2Channel.impl;
  pulserate: system PulseoxPulserateChannel.impl;

connections
  c1: feature group spo2.metrics <-> spo2_metrics;      
  c2: feature group spo2.settings <-> spo2_settings;      
  c3: feature group pulserate.metrics <-> pulserate_metrics;      
  c4: feature group pulserate.statuses <-> pulserate_statuses;        

properties  
  MDCF_Data_Props::IEEE11073_MDC_ATTR_SYS_TYPE => "Nonin PO";

  MDCF_Data_Props::manufacturerModel => [
    MDC_ATTR_ID_MODEL => [
      manufacturer => "Nonin";
      model_number => "Onyx II X5551122"; 
    ];
  ];
end PulseoxDevice.impl;


------------------------------------------------------------------------------+
-- Pulseox VMD port groupings
------------------------------------------------------------------------------+
feature group PulseoxStatus
features
  status_exchange_in: in event port {
    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  status_exchange_out: out event data port ICE_Types::ICE_VMD_Status {   
    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };
end PulseoxStatus;


------------------------------------------------------------------------------+
-- Pulseox VMD channels & port groupings
------------------------------------------------------------------------------+
system PulseoxSpo2Channel
features
  metrics: feature group PulseoxSpo2Metrics;
  settings: feature group PulseoxSpo2Settings;
end PulseoxSpo2Channel;  

system implementation PulseoxSpo2Channel.impl
properties
  MDCF_Data_Props::MDC_ATTR_ID_PARAM_GRP => "SpO2 Channel";  
end PulseoxSpo2Channel.impl;


feature group PulseoxSpo2Metrics
features
  spo2_num_get_in: in event port {
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_PULS_OXIM_SAT_O2";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_PERCENT";     

    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  spo2_num_get_out: out event data port ICE_Types::ICE_SpO2_Numeric {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_PULS_OXIM_SAT_O2";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_PERCENT";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };
  spo2_num_periodic_out: out event data port ICE_Types::ICE_SpO2_Numeric {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_PULS_OXIM_SAT_O2";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_PERCENT";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => publisher;
      Output_Rate => 105ms .. 110ms;
    ];
  };

  etco2_num_get_in: in event port {
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_CAPNOGRAPHY_ETCO2";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_PERCENT";     

    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  etco2_num_get_out: out event data port ICE_Types::ICE_EtCo2_Numeric {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_CAPNOGRAPHY_ETCO2";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_PERCENT";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };
  etco2_num_periodic_out: out event data port ICE_Types::ICE_EtCo2_Numeric {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_CAPNOGRAPHY_ETCO2";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_PERCENT";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => publisher;
      Output_Rate => 105ms .. 110ms;
    ];
  };
end PulseoxSpo2Metrics;


feature group PulseoxSpo2Settings
features
  spo2_setting1_get_in: in event port {
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "SOME_SETTING_ID";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "SOME_SETTING_UNIT";     

    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  spo2_setting1_get_out: out event data port ICE_Types::ICE_Setting {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "SOME_SETTING_ID";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "SOME_SETTING_UNIT";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };

  spo2_setting2_get_in: in event port {
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "SOME_SETTING_ID";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "SOME_SETTING_UNIT";     

    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  spo2_setting2_get_out: out event data port ICE_Types::ICE_Setting {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "SOME_SETTING_ID";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "SOME_SETTING_UNIT";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };
end PulseoxSpo2Settings;


system PulseoxPulserateChannel
features
  metrics: feature group PulseoxPulserateMetrics;
  statuses: feature group PulseoxPulserateStatuses;
end PulseoxPulserateChannel;  

system implementation PulseoxPulserateChannel.impl
properties
  MDCF_Data_Props::MDC_ATTR_ID_PARAM_GRP => "Pulse Rate Channel";  
end PulseoxPulserateChannel.impl;


feature group PulseoxPulserateMetrics
features
  pulserate_num_get_in: in event port {
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_PULS_OXIM_PULS_RATE";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_BEAT_PER_MIN";     

    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  pulserate_num_get_out: out event data port ICE_Types::ICE_PulseRate_Numeric {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_PULS_OXIM_PULS_RATE";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_BEAT_PER_MIN";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };
  pulserate_num_periodic_out: out event data port ICE_Types::ICE_PulseRate_Numeric {   
    MDCF_Data_Props::MDC_ATTR_ID_PHYSIO => "MDC_PULS_OXIM_PULS_RATE";
    MDCF_Data_Props::MDC_ATTR_UNIT_CODE => "MDC_DIM_BEAT_PER_MIN";     

    MDCF_Comm_Props::DML_Port => [
      Comm_Role => publisher;
      Output_Rate => 105ms .. 110ms;
    ];
  };
end PulseoxPulserateMetrics;


feature group PulseoxPulserateStatuses
features
  pulserate_stat1_exchange_in: in event port {
    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  pulserate_stat1_exchange_out: out event data port ICE_Types::ICE_Status {   
    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };

  pulserate_stat2_exchange_in: in event port {
    MDCF_Comm_Props::DML_Port => [                                
      Comm_Role => responder; 
      Output_Rate => 5ms .. 50ms;
    ];
  };
  pulserate_stat2_exchange_out: out event data port ICE_Types::ICE_VMD_Status {   
    MDCF_Comm_Props::DML_Port => [
      Comm_Role => responder;
      Output_Rate => 5ms .. 50ms;
    ];
  };
end PulseoxPulserateStatuses;
end PulseOx;
